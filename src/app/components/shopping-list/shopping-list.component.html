<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Colonne Liste Courante -->
  <div class="lg:col-span-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Liste de courses</h2>
      <div class="flex gap-2">
        <button
          (click)="toggleAutoRefresh()"
          class="px-3 py-2 border rounded text-sm"
          [class.border-green-400]="autoRefresh()"
          [class.text-green-600]="autoRefresh()"
          [class.border-gray-300]="!autoRefresh()"
          [class.dark:border-gray-600]="!autoRefresh()"
          [class.text-gray-700]="!autoRefresh()"
          [class.dark:text-gray-200]="!autoRefresh()"
          [class.bg-green-50]="autoRefresh()"
        >
          {{ autoRefresh() ? "A-R: ON" : "A-R: OFF" }}
        </button>
        <button
          (click)="shopping.clearChecked()"
          class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-200"
        >
          Retirer cochés
        </button>
        <button
          (click)="shopping.clearAll()"
          class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-200"
        >
          Vider
        </button>
      </div>
    </div>

    @if (shopping.currentList().length === 0) {
      <p class="text-gray-500 dark:text-gray-400">Aucun article pour le moment.</p>
    } @else {
      <ul class="divide-y divide-gray-200 dark:divide-gray-700">
        @for (entry of shopping.currentList(); track entry.id) {
          <li class="py-3 flex items-center gap-3">
            <input
              type="checkbox"
              [checked]="entry.checked"
              (change)="toggle(entry.id)"
              class="h-5 w-5 text-blue-600 dark:text-blue-400 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400"
            />
            <div class="flex-1">
              <div class="font-medium text-gray-900 dark:text-white" [class.line-through]="entry.checked">
                {{ entry.name }}
              </div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Quantité: {{ entry.quantity }}</div>
            </div>
            <div class="flex items-center gap-2">
              <button
                (click)="dec(entry.id)"
                class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"
              >
                -
              </button>
              <button
                (click)="inc(entry.id)"
                class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200"
              >
                +
              </button>
              <button
                (click)="remove(entry.id)"
                class="px-2 py-1 border border-red-300 dark:border-red-600 rounded text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20"
              >
                Supprimer
              </button>
            </div>
          </li>
        }
      </ul>
    }
  </div>

  <!-- Colonne Catalogue -->
  <div>
    <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Catalogue</h2>

    <div class="space-y-3 mb-4">
      <input
        type="text"
        name="name"
        placeholder="Nom de l'article"
        [ngModel]="newItemName()"
        (ngModelChange)="newItemName.set($event)"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
      />
      <input
        type="text"
        name="category"
        placeholder="Catégorie (optionnel)"
        [ngModel]="newItemCategory()"
        (ngModelChange)="newItemCategory.set($event)"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
      />
      <button
        (click)="addCatalogItem()"
        class="w-full px-3 py-2 bg-blue-600 dark:bg-blue-600 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-700 transition-colors"
      >
        Ajouter au catalogue
      </button>
    </div>

    <div class="mb-2">
      <input
        type="text"
        id="search"
        placeholder="Rechercher..."
        [ngModel]="search()"
        (ngModelChange)="search.set($event)"
        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
      />
    </div>

    @if (filteredCatalog().length === 0) {
      <p class="text-gray-500 dark:text-gray-400">Aucun article dans le catalogue.</p>
    } @else {
      <ul class="divide-y divide-gray-200 dark:divide-gray-700">
        @for (item of filteredCatalog(); track item.id) {
          <li class="py-3 flex items-center justify-between">
            <div class="flex-1">
              @if (editingId() === item.id) {
                <div class="flex flex-col gap-2">
                  <input
                    type="text"
                    name="name"
                    placeholder="Nom"
                    [ngModel]="editName()"
                    (ngModelChange)="editName.set($event)"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                  <input
                    type="text"
                    name="category"
                    placeholder="Catégorie (optionnel)"
                    [ngModel]="editCategory()"
                    (ngModelChange)="editCategory.set($event)"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
              } @else {
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">{{ item.name }}</div>
                  @if (item.category) {
                    <div class="text-sm text-gray-500 dark:text-gray-400">{{ item.category }}</div>
                  }
                </div>
              }
            </div>
            <div class="flex items-center gap-2">
              @if (editingId() === item.id) {
                <button
                  (click)="saveEdit()"
                  class="px-3 py-1 bg-green-600 dark:bg-green-600 text-white rounded hover:bg-green-700 dark:hover:bg-green-700 transition-colors"
                >
                  Enregistrer
                </button>
                <button
                  (click)="cancelEdit()"
                  class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 transition-colors"
                >
                  Annuler
                </button>
              } @else {
                <button
                  (click)="addToList(item.id)"
                  class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 transition-colors"
                >
                  Ajouter
                </button>
                <button
                  (click)="startEdit(item.id)"
                  class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 transition-colors"
                >
                  Modifier
                </button>
              }
            </div>
          </li>
        }
      </ul>
    }
  </div>
</div>
