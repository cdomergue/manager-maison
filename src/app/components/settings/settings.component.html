<div class="max-w-4xl mx-auto p-5 space-y-6">
  <!-- En-t√™te avec bouton de retour -->
  <div class="flex items-center gap-4 mb-8">
    <button
      class="bg-gray-500 dark:bg-gray-600 text-white hover:bg-gray-600 dark:hover:bg-gray-500 px-4 py-2 rounded-lg transition-colors inline-flex items-center font-medium"
      routerLink="/"
      title="Retour √† l'accueil"
    >
      ‚Üê Retour
    </button>
    <h2 class="text-3xl font-bold text-gray-800 dark:text-white flex-1">Param√®tres</h2>
  </div>

  <!-- Statut du serveur -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3
      class="text-xl font-semibold text-gray-800 dark:text-white mb-4 pb-2 border-b-2 border-gray-200 dark:border-gray-600"
    >
      Statut du serveur
    </h3>
    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3">
      <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
        <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Connexion :</span>
        <span
          class="font-semibold flex-1 text-right mr-2"
          [ngClass]="{
            'text-green-600 dark:text-green-400': isServerConnected(),
            'text-red-600 dark:text-red-400': !isServerConnected(),
          }"
        >
          {{ connectionStatus() }}
        </span>
        <button
          class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-sm transition-colors disabled:cursor-not-allowed"
          (click)="refreshServerStatus()"
          [disabled]="connectionStatus() === 'V√©rification...'"
        >
          üîÑ
        </button>
      </div>

      @if (serverStatus()) {
        <div
          class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0"
        >
          <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">T√¢ches totales :</span>
          <span class="font-semibold text-gray-900 dark:text-white">{{ serverStatus()?.totalTasks }}</span>
        </div>

        <div
          class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0"
        >
          <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Derni√®re mise √† jour :</span>
          <span class="font-semibold text-gray-900 dark:text-white">{{
            serverStatus()?.lastUpdated | date: "dd/MM/yyyy HH:mm"
          }}</span>
        </div>

        <div
          class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0"
        >
          <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Heure du serveur :</span>
          <span class="font-semibold text-gray-900 dark:text-white">{{
            serverStatus()?.serverTime | date: "dd/MM/yyyy HH:mm:ss"
          }}</span>
        </div>
      }
    </div>
  </div>

  <!-- V√©rification en arri√®re-plan -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3
      class="text-xl font-semibold text-gray-800 dark:text-white mb-4 pb-2 border-b-2 border-gray-200 dark:border-gray-600"
    >
      V√©rification en arri√®re-plan
    </h3>
    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3">
      <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
        <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Statut :</span>
        <span
          class="font-semibold flex-1 text-right mr-2"
          [ngClass]="{
            'text-green-600 dark:text-green-400': !isCheckingBackground(),
            'text-red-600 dark:text-red-400': isCheckingBackground(),
          }"
        >
          {{ isCheckingBackground() ? "V√©rification en cours..." : "Actif" }}
        </span>
        <button
          class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-2 py-1 rounded text-sm transition-colors disabled:cursor-not-allowed"
          (click)="forceBackgroundCheck()"
          [disabled]="isCheckingBackground()"
        >
          üîç
        </button>
      </div>

      @if (lastBackgroundCheck()) {
        <div
          class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0"
        >
          <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Derni√®re v√©rification :</span>
          <span class="font-semibold text-gray-900 dark:text-white">{{
            lastBackgroundCheck() | date: "HH:mm:ss"
          }}</span>
        </div>
      }

      <div class="flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
        <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[150px]">Intervalle :</span>
        <span class="font-semibold text-gray-900 dark:text-white">{{ backgroundCheckInterval() / 1000 }} secondes</span>
      </div>
    </div>
  </div>

  <!-- Apparence -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3
      class="text-xl font-semibold text-gray-800 dark:text-white mb-4 pb-2 border-b-2 border-gray-200 dark:border-gray-600"
    >
      Apparence
    </h3>
    <div class="flex flex-col gap-4">
      <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        <div class="flex items-center gap-2 flex-wrap">
          <span class="font-medium text-gray-700 dark:text-gray-300 min-w-[120px]">Th√®me actuel :</span>
          <span class="font-semibold text-gray-900 dark:text-white">
            {{ getThemeDisplayName(currentTheme()) }}
            {{ getThemeIcon(currentTheme()) }}
          </span>
          @if (currentTheme() === "auto") {
            <span class="text-sm text-gray-600 dark:text-gray-400 italic"
              >({{ effectiveTheme() === "dark" ? "Sombre" : "Clair" }} d√©tect√©)</span
            >
          }
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        @for (option of themeOptions; track option.value) {
          <button
            class="bg-white dark:bg-gray-700 border-2 rounded-lg p-4 cursor-pointer transition-all duration-200 flex flex-col items-center gap-2 text-center hover:border-blue-500 hover:-translate-y-1 hover:shadow-lg"
            [ngClass]="{
              'border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300':
                currentTheme() === option.value,
              'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300': currentTheme() !== option.value,
            }"
            (click)="onThemeChange(option.value)"
          >
            <span class="text-2xl">{{ option.icon }}</span>
            <span class="font-semibold text-sm">{{ option.label }}</span>
            @if (option.value === "auto") {
              <span class="text-xs text-gray-600 dark:text-gray-400 mt-1">Suit les pr√©f√©rences syst√®me</span>
            }
          </button>
        }
      </div>

      <div class="flex justify-center">
        <button
          class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold text-sm transition-all duration-200 shadow-md hover:-translate-y-1 hover:shadow-lg"
          (click)="toggleTheme()"
        >
          {{ isDarkMode() ? "‚òÄÔ∏è" : "üåô" }} Basculer le th√®me
        </button>
      </div>
    </div>
  </div>

  <!-- Stockage local -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3
      class="text-xl font-semibold text-gray-800 dark:text-white mb-4 pb-2 border-b-2 border-gray-200 dark:border-gray-600"
    >
      Stockage local
    </h3>
    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-4">
      <p class="text-gray-700 dark:text-gray-300 font-medium">Taille utilis√©e : {{ storageSize() | number }} octets</p>
      <button
        class="bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-lg font-medium transition-colors"
        (click)="clearLocalStorage()"
      >
        Effacer toutes les donn√©es locales
      </button>
    </div>
  </div>

  <!-- Informations -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3
      class="text-xl font-semibold text-gray-800 dark:text-white mb-4 pb-2 border-b-2 border-gray-200 dark:border-gray-600"
    >
      Informations
    </h3>
    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-4">
      <div>
        <p class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Mode de fonctionnement :</p>
        <ul class="list-none pl-0 space-y-1">
          @if (isServerConnected()) {
            <li class="text-gray-600 dark:text-gray-400 text-sm">
              ‚úÖ Mode serveur : Les donn√©es sont synchronis√©es avec le serveur local
            </li>
          } @else {
            <li class="text-gray-600 dark:text-gray-400 text-sm">
              ‚ö†Ô∏è Mode local : Les donn√©es sont stock√©es uniquement dans le navigateur
            </li>
          }
        </ul>
      </div>

      <div>
        <p class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Partage des donn√©es :</p>
        <ul class="list-none pl-0 space-y-1">
          @if (isServerConnected()) {
            <li class="text-gray-600 dark:text-gray-400 text-sm">
              ‚úÖ Les t√¢ches sont partag√©es entre tous les utilisateurs connect√©s au serveur
            </li>
          } @else {
            <li class="text-gray-600 dark:text-gray-400 text-sm">
              ‚ùå Les t√¢ches ne sont pas partag√©es (mode hors ligne)
            </li>
          }
        </ul>
      </div>
    </div>
  </div>
</div>
